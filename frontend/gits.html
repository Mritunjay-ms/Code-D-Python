<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Simple Alumni Platform (Firebase) - Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* Basic styles to make it usable */
    body{font-family:system-ui,Segoe UI,Roboto,Arial;background:#f4f7fb;margin:0;padding:20px;color:#222}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .card{background:#fff;border-radius:10px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,0.06);margin-bottom:12px}
    input,select,textarea,button{padding:8px;border:1px solid #ddd;border-radius:6px;font-size:14px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .col{flex:1 1 300px}
    .btn{background:#2563eb;color:#fff;border:none;cursor:pointer}
    .small{font-size:13px;color:#555}
    .muted{color:#666;font-size:13px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .item{padding:8px;border-radius:6px;border:1px solid #eee}
    nav button{margin-left:8px}
    label{display:block;margin-bottom:6px;font-weight:600}
  </style>
</head>
<body>
  <header>
    <h2>Alumni Platform — Demo</h2>
    <div id="authArea" class="muted">
      <span id="userEmail">Not signed in</span>
      <button id="signOutBtn" class="btn" style="display:none">Sign out</button>
    </div>
  </header>

  <!-- AUTH CARD -->
  <div class="card" id="authCard">
    <div class="row">
      <div class="col">
        <h3>Sign up</h3>
        <label>Email</label><input id="suEmail" type="email" placeholder="email" />
        <label>Password</label><input id="suPass" type="password" placeholder="password" />
        <br/><br/>
        <button class="btn" onclick="signUp()">Create Account</button>
      </div>

      <div class="col">
        <h3>Sign in</h3>
        <label>Email</label><input id="siEmail" type="email" placeholder="email" />
        <label>Password</label><input id="siPass" type="password" placeholder="password" />
        <br/><br/>
        <button class="btn" onclick="signIn()">Sign In</button>
      </div>
    </div>
  </div>

  <!-- PROFILE CARD -->
  <div class="card" id="profileCard" style="display:none">
    <h3>Your Profile</h3>
    <div class="row">
      <div class="col">
        <label>Full name</label><input id="pName" placeholder="e.g. Rahul Kumar" />
        <label>Batch year</label><input id="pBatch" placeholder="e.g. 2019" />
        <label>Course</label><input id="pCourse" placeholder="e.g. B.Tech CSE" />
        <label>Current company / location</label><input id="pCompany" placeholder="e.g. Google, Bangalore" />
      </div>
    </div>
    <br/>
    <button class="btn" onclick="saveProfile()">Save Profile</button>
    <span id="profileMsg" class="small muted"></span>
  </div>

  <!-- NAV -->
  <div class="card">
    <nav>
      <button onclick="showSection('directory')">Alumni Directory</button>
      <button onclick="showSection('news')">News & Updates</button>
      <button onclick="showSection('events')">Events</button>
      <button onclick="showSection('jobs')">Jobs</button>
      <button onclick="showSection('feedback')">Feedback</button>
      <button onclick="showSection('contact')">Contact</button>
      <span class="muted" style="margin-left:16px">(Admin: <span id="adminSpan"></span>)</span>
    </nav>
  </div>

  <!-- DIRECTORY -->
  <div id="directory" class="card" style="display:none">
    <h3>Alumni Directory</h3>
    <div class="row">
      <div class="col">
        <label>Search name / company</label>
        <input id="dirSearch" placeholder="Type name, company..." oninput="loadDirectory()" />
      </div>
      <div style="width:220px">
        <label>Filter by batch</label>
        <input id="dirBatch" placeholder="e.g. 2019" oninput="loadDirectory()" />
      </div>
      <div style="width:220px">
        <label>Filter by course</label>
        <input id="dirCourse" placeholder="e.g. CSE" oninput="loadDirectory()" />
      </div>
    </div>
    <br/>
    <div id="dirList" class="grid"></div>
  </div>

  <!-- NEWS -->
  <div id="news" class="card" style="display:none">
    <h3>News & Updates</h3>
    <div id="adminNewsArea" style="display:none" class="card">
      <label>Title</label><input id="newsTitle" />
      <label>Details</label><textarea id="newsBody"></textarea>
      <br/><br/>
      <button class="btn" onclick="addNews()">Post News</button>
    </div>
    <div id="newsList"></div>
  </div>

  <!-- EVENTS -->
  <div id="events" class="card" style="display:none">
    <h3>Events</h3>
    <div id="adminEventArea" style="display:none" class="card">
      <label>Event Title</label><input id="evTitle" />
      <label>Date & Time</label><input id="evDate" type="datetime-local" />
      <label>Details</label><textarea id="evDesc"></textarea>
      <br/><br/>
      <button class="btn" onclick="addEvent()">Create Event</button>
    </div>
    <div id="eventList"></div>
  </div>

  <!-- JOBS -->
  <div id="jobs" class="card" style="display:none">
    <h3>Jobs / Internships</h3>
    <div id="adminJobArea" style="display:none" class="card">
      <label>Role / Title</label><input id="jobTitle" />
      <label>Company</label><input id="jobCompany" />
      <label>Details / Link</label><textarea id="jobDetails"></textarea>
      <br/><br/>
      <button class="btn" onclick="addJob()">Post Job</button>
    </div>
    <div id="jobList"></div>
  </div>

  <!-- FEEDBACK -->
  <div id="feedback" class="card" style="display:none">
    <h3>Feedback & Suggestions</h3>
    <label>Your suggestion</label><textarea id="fbText"></textarea><br/>
    <button class="btn" onclick="sendFeedback()">Send Feedback</button>
    <div id="fbMsg" class="small muted"></div>
  </div>

  <!-- CONTACT -->
  <div id="contact" class="card" style="display:none">
    <h3>Contact Admin</h3>
    <label>Message</label><textarea id="contactMsg"></textarea><br/>
    <button class="btn" onclick="sendContact()">Send</button>
    <div id="contactResult" class="small muted"></div>
  </div>

  <script type="module">
    // ------- FIREBASE SETUP -------
    // 1) Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "REPLACE_WITH_YOUR_apiKey",
      authDomain: "REPLACE_WITH_YOUR_authDomain",
      projectId: "REPLACE_WITH_YOUR_projectId",
      //... rest (storageBucket, messagingSenderId, appId)
    };

    // 2) Set admin email (who can post news/jobs/events). Change to your admin email.
    const ADMIN_EMAIL = "admin@example.com";
    document.getElementById('adminSpan').innerText = ADMIN_EMAIL;

    // Import Firebase v9 modular from CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, where, getDocs, orderBy, deleteDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // UI references
    const userEmailEl = document.getElementById('userEmail');
    const signOutBtn = document.getElementById('signOutBtn');
    const profileCard = document.getElementById('profileCard');
    const authCard = document.getElementById('authCard');
    const adminNewsArea = document.getElementById('adminNewsArea');
    const adminEventArea = document.getElementById('adminEventArea');
    const adminJobArea = document.getElementById('adminJobArea');

    // Simple show section function
    function showSection(id) {
      ['directory','news','events','jobs','feedback','contact'].forEach(s => {
        document.getElementById(s).style.display = (s===id) ? 'block' : 'none';
      });
      if(id==='directory') loadDirectory();
      if(id==='news') loadNews();
      if(id==='events') loadEvents();
      if(id==='jobs') loadJobs();
    }

    // AUTH FUNCTIONS
    async function signUp(){
      const email = document.getElementById('suEmail').value;
      const pass  = document.getElementById('suPass').value;
      try{
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        alert('Account created. Please complete your profile.');
      }catch(e){
        alert('Sign up error: ' + e.message);
      }
    }

    async function signIn(){
      const email = document.getElementById('siEmail').value;
      const pass  = document.getElementById('siPass').value;
      try {
        await signInWithEmailAndPassword(auth, email, pass);
      } catch(e){
        alert('Sign in error: ' + e.message);
      }
    }

    signOutBtn.onclick = () => signOut(auth);

    onAuthStateChanged(auth, async user => {
      if(user){
        userEmailEl.innerText = user.email;
        signOutBtn.style.display = 'inline-block';
        authCard.style.display = 'none';
        profileCard.style.display = 'block';
        document.getElementById('profileMsg').innerText = '';
        // show admin areas if email matches
        const isAdmin = (user.email === ADMIN_EMAIL);
        adminNewsArea.style.display = isAdmin ? 'block' : 'none';
        adminEventArea.style.display = isAdmin ? 'block' : 'none';
        adminJobArea.style.display = isAdmin ? 'block' : 'none';
        // load profile if exists
        const pRef = doc(db, 'users', user.uid);
        const snap = await getDoc(pRef);
        if(snap.exists()){
          const d = snap.data();
          document.getElementById('pName').value = d.name || '';
          document.getElementById('pBatch').value = d.batch || '';
          document.getElementById('pCourse').value = d.course || '';
          document.getElementById('pCompany').value = d.company || '';
        }
      } else {
        userEmailEl.innerText = 'Not signed in';
        signOutBtn.style.display = 'none';
        authCard.style.display = 'block';
        profileCard.style.display = 'none';
        adminNewsArea.style.display = 'none';
        adminEventArea.style.display = 'none';
        adminJobArea.style.display = 'none';
      }
    });

    // PROFILE SAVE
    async function saveProfile(){
      const user = auth.currentUser;
      if(!user){ alert('Please sign in'); return; }
      const p = {
        name: document.getElementById('pName').value,
        batch: document.getElementById('pBatch').value,
        course: document.getElementById('pCourse').value,
        company: document.getElementById('pCompany').value,
        email: user.email
      };
      try{
        await setDoc(doc(db, 'users', user.uid), p, { merge:true });
        document.getElementById('profileMsg').innerText = 'Saved ✔';
        loadDirectory();
      } catch(e){
        alert('Save error: ' + e.message);
      }
    }

    // DIRECTORY: load and filter
    async function loadDirectory(){
      const qText = document.getElementById('dirSearch').value.toLowerCase();
      const batchF = (document.getElementById('dirBatch').value||'').trim();
      const courseF = (document.getElementById('dirCourse').value||'').trim().toLowerCase();

      const usersCol = collection(db, 'users');
      const q = query(usersCol); // simple: load all then filter client-side (ok for small demo)
      const snap = await getDocs(q);
      const listEl = document.getElementById('dirList');
      listEl.innerHTML = '';
      snap.forEach(d => {
        const data = d.data();
        // simple client-side filters
        let nameMatch = true;
        if(qText) {
          nameMatch = ((data.name||'') + ' ' + (data.company||'') + ' ' + (data.email||'')).toLowerCase().includes(qText);
        }
        if(batchF && data.batch !== batchF) nameMatch = false;
        if(courseF && !(data.course || '').toLowerCase().includes(courseF)) nameMatch = false;

        if(nameMatch){
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `<strong>${escapeHtml(data.name||'—')}</strong><div class="small">${escapeHtml(data.course||'')} • ${escapeHtml(data.batch||'')}</div>
            <div class="muted">${escapeHtml(data.company||'')}</div>
            <div class="small">Email: ${escapeHtml(data.email||'')}</div>`;
          listEl.appendChild(div);
        }
      });
      if(listEl.children.length === 0) listEl.innerHTML = '<div class="muted">No alumni found. Ask them to create profile.</div>';
    }

    // NEWS
    async function addNews(){
      const user = auth.currentUser;
      if(!user || user.email !== ADMIN_EMAIL){ alert('Only admin can post news'); return; }
      const title = document.getElementById('newsTitle').value.trim();
      const body = document.getElementById('newsBody').value.trim();
      if(!title) return alert('Add title');
      await addDoc(collection(db, 'news'), { title, body, createdAt: new Date().toISOString(), author: user.email });
      document.getElementById('newsTitle').value = '';
      document.getElementById('newsBody').value = '';
      loadNews();
    }

    async function loadNews(){
      const snap = await getDocs(collection(db, 'news'));
      const list = document.getElementById('newsList');
      list.innerHTML = '';
      snap.forEach(d => {
        const data = d.data();
        const id = d.id;
        const el = document.createElement('div');
        el.className = 'item';
        el.innerHTML = `<strong>${escapeHtml(data.title)}</strong><div class="small">${escapeHtml(data.body)}</div>
          <div class="muted small">Posted: ${escapeHtml(data.createdAt||'')}</div>`;
        const user = auth.currentUser;
        if(user && user.email === ADMIN_EMAIL){
          const del = document.createElement('button');
          del.className = 'btn';
          del.style.background='#ef4444';
          del.innerText='Delete';
          del.onclick = async () => { await deleteDoc(doc(db,'news',id)); loadNews(); };
          el.appendChild(del);
        }
        list.appendChild(el);
      });
      if(list.children.length === 0) list.innerHTML = '<div class="muted">No news yet.</div>';
    }

    // EVENTS
    async function addEvent(){
      const user = auth.currentUser;
      if(!user || user.email !== ADMIN_EMAIL){ alert('Only admin can create events'); return; }
      const t = document.getElementById('evTitle').value.trim();
      const dt = document.getElementById('evDate').value;
      const desc = document.getElementById('evDesc').value.trim();
      if(!t) return alert('Add event title');
      await addDoc(collection(db, 'events'), { title:t, date:dt, description:desc, createdAt:new Date().toISOString() });
      document.getElementById('evTitle').value=''; document.getElementById('evDate').value=''; document.getElementById('evDesc').value='';
      loadEvents();
    }

    async function loadEvents(){
      const snap = await getDocs(collection(db, 'events'));
      const list = document.getElementById('eventList');
      list.innerHTML='';
      snap.forEach(d=>{
        const data = d.data(); const id = d.id;
        const el = document.createElement('div'); el.className='item';
        el.innerHTML = `<strong>${escapeHtml(data.title)}</strong>
          <div class="small">${escapeHtml(data.date||'')}</div>
          <div class="muted small">${escapeHtml(data.description||'')}</div>`;
        // register button
        const btn = document.createElement('button'); btn.className='btn'; btn.innerText='Register';
        btn.onclick = async ()=>{
          const user = auth.currentUser;
          if(!user) return alert('Login to register');
          // create participants subcollection or arrayUnion
          const evRef = doc(db,'events',id);
          await updateDoc(evRef, { participants: arrayUnion({ uid:user.uid, email:user.email, name: (document.getElementById('pName').value||user.email) }) });
          alert('Registered ✔');
          loadEvents();
        };
        el.appendChild(btn);
        // show participants count if exists
        if(Array.isArray(data.participants)) {
          const pcount = document.createElement('div'); pcount.className='small muted';
          pcount.innerText = `Participants: ${data.participants.length}`;
          el.appendChild(pcount);
        }
        list.appendChild(el);
      });
      if(list.children.length === 0) list.innerHTML = '<div class="muted">No events.</div>';
    }

    // JOBS
    async function addJob(){
      const user = auth.currentUser;
      if(!user || user.email !== ADMIN_EMAIL) { alert('Only admin can post jobs'); return; }
      const t = document.getElementById('jobTitle').value.trim();
      const company = document.getElementById('jobCompany').value.trim();
      const details = document.getElementById('jobDetails').value.trim();
      if(!t) return alert('Add job title');
      await addDoc(collection(db, 'jobs'), { title:t, company, details, createdAt:new Date().toISOString() });
      document.getElementById('jobTitle').value=''; document.getElementById('jobCompany').value=''; document.getElementById('jobDetails').value='';
      loadJobs();
    }

    async function loadJobs(){
      const snap = await getDocs(collection(db,'jobs'));
      const list = document.getElementById('jobList'); list.innerHTML='';
      snap.forEach(d=>{
        const data = d.data();
        const el = document.createElement('div'); el.className='item';
        el.innerHTML = `<strong>${escapeHtml(data.title)}</strong><div class="small">${escapeHtml(data.company||'')}</div>
          <div class="muted small">${escapeHtml(data.details||'')}</div>`;
        list.appendChild(el);
      });
      if(list.children.length === 0) list.innerHTML = '<div class="muted">No jobs yet.</div>';
    }

    // FEEDBACK
    async function sendFeedback(){
      const user = auth.currentUser;
      const text = document.getElementById('fbText').value.trim();
      if(!text) return alert('Write something');
      await addDoc(collection(db,'feedback'), { text, user: user ? user.email : 'anon', createdAt: new Date().toISOString() });
      document.getElementById('fbText').value='';
      document.getElementById('fbMsg').innerText='Thanks for your feedback!';
    }

    // CONTACT
    async function sendContact(){
      const user = auth.currentUser;
      const msg = document.getElementById('contactMsg').value.trim();
      if(!msg) return alert('Write message');
      await addDoc(collection(db,'contacts'), { msg, user: user ? user.email : 'anon', createdAt: new Date().toISOString() });
      document.getElementById('contactMsg').value=''; document.getElementById('contactResult').innerText='Message sent to admin.';
    }

    // Utilities
    function escapeHtml(s=''){ return String(s).replace(/[&<>"']/g, function(m){return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])}); }

    // Initial view
    showSection('directory');

  </script>
</body>
</html>
